--https://github.com/iweld/aliens_of_america/blob/main/ANALYSIS.md

--create database aliens;
--use aliens

--select * from aliens 
--select * from details 
--select * from location 


--How many records are in the dataset?

--select count(id)  from aliens 



--Are there any duplicate email addresses which could indicate duplicate records?

--select * from aliens

--select email , rn= ROW_NUMBER () over (partition by email order by email ) 
--from aliens 
--order by rn desc


--How many countrys are present in our dataset?

--select count(distinct country) as count 
--from location 



--Are all states represented in the dataset?


--select state
--from location
--group by state	



--What is the count of aliens per state and what is the average age? Order from highest to lowest population.
-- Include the percentage of hostile vs. friendly aliens per state. Limit the first 10 for brevity.

--select * from aliens
--select * from details 

--alter table details 
--alter column aggressive float;

--with cte as ( select count(aliens.id) as "count" , location.state , cast(avg( '2023'- aliens.birth_year)as int) as "age" ,
--count(details.aggressive) as "total" ,sum(details.aggressive) as "agressive" , (count(details.aggressive) - sum(details.aggressive)) as "friendly"
--from aliens join location 
--on aliens.id = location.loc_id
--join details 
--on aliens.id = details.detail_id 
--group by location.state ) 
--select top 10 * ,cast((cte.friendly/cte.total)as decimal (2,2)) as "f%" ,cast((cte.agressive/cte.total)as decimal(2,2)) as "A%" from cte 
--order by count desc



--What are the yougest and oldest alien ages in the U.S.?

with old as ( select    max( '2023' - birth_year ) as "oldest age"  from aliens  ) 

, young as  ( select   min( '2023' - birth_year ) as "youngest age"  from aliens  ) 

 select * from young ,  old 

select *, ( '2023' - birth_year ) as "age"  from aliens 






--The U.S. Bureau of Economic Analysis developed an eight-region map of the US seen below. 
What regions have the highest population of aliens and what is the overall population percentage per region?

https://github.com/iweld/aliens_of_america/raw/main/images/bea_us_regions.JPG



--What is the alien population and gender percentage per region? Rank results according to gender percentage results.
--How many different aliens species live in the U.S. and are they concentrated in any particular region? 
--Use a cte to rank the species type by their region and return the top 2 ranked species per region.
--What is the top favorite food of every species including ties?
--Which are the top 10 cities where aliens are located and is the population majority hostile or friendly?

